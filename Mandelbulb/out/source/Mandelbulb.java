/* autogenerated by Processing revision 1297 on 2025-07-23 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import peasy.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class Mandelbulb extends PApplet {



int DIM = 256;
int n = 8;
int maxIterations = 10;

PeasyCam cam;
ArrayList<PVector> mandelbulb = new ArrayList<PVector>();

class Spherical {
    float r, theta, phi;
    Spherical(float r, float theta, float phi) {
        this.r = r;
        this.theta = theta;
        this.phi = phi;
    }
}

public Spherical getSphericalCoords(float x, float y, float z) {
    float r     = sqrt(x*x + y*y + z*z);
    float theta = atan2(sqrt(x*x + y*y), z);
    float phi   = atan2(y, x);
    return new Spherical(r, theta, phi);
}

public void calcMandelBulb() {
    for(int i=0; i<DIM; i++) {
        for (int j=0; j<DIM; j++) {
            boolean edge = false;
            for(int k=0; k<DIM; k++) {

                float x = map(i, 0, DIM, -1, 1);
                float y = map(j, 0, DIM, -1, 1);
                float z = map(k, 0, DIM, -1, 1);

                PVector zeta = new PVector(0, 0, 0);
                int iteration = 0;
                while(true) {
                    Spherical c = getSphericalCoords(zeta.x, zeta.y, zeta.z);

                    float newx = pow(c.r, n) * sin(c.theta*n) * cos(c.phi*n);
                    float newy = pow(c.r, n) * sin(c.theta*n) * sin(c.phi*n);
                    float newz = pow(c.r, n) * cos(c.theta*n);

                    zeta.x = newx + x;
                    zeta.y = newy + y;
                    zeta.z = newz + z;

                    iteration++;
                    if(c.r > 2) {
                        if(edge) {
                            edge = false;
                        }
                        break;
                    }
                    if(iteration > maxIterations) {
                        if(!edge) {
                            edge = true;
                            mandelbulb.add(new PVector(x*100, y*100, z*100));
                        }
                        break;
                    }
                }
            }
        }
    }
}

public void setup() {
    /* size commented out by preprocessor */;
    cam = new PeasyCam(this, 500);
    calcMandelBulb();
    stroke(255);
}

public void draw() {
    background(0);
    for(PVector pv: mandelbulb) {
        point(pv.x, pv.y, pv.z);
    }
}


  public void settings() { fullScreen(P3D); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "Mandelbulb" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
